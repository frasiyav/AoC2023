âŸ¨ Split âŸ© â† â€¢Import "bqn-libs/strings.bqn"
i â† â€¢file.Lines "input20.txt"

[modules,dst] â† â‰>" -> "âŠ¸SplitÂ¨i
types â† ("b%&"âŠ‘âˆ˜âŠâŠ‘)Â¨modules
k â† 1âŠ¸â†“Â¨âŒ¾((0â‰ types)âŠ¸/)modules
dst ", "âŠ¸SplitÂ¨â†©
k âˆ¾â†© <"rx"
dst âˆ¾â†© <âŸ¨âŸ©
types âˆ¾â†© 4
dst kâŠ¸âŠÂ¨â†©
bcâ€¿rxâ† kâŠ"broadcaster"â€¿"rx"
src â† <âˆ˜/Ë˜â‰>((â‰ k)â†‘/â¼)Â¨dst
rxi â† {!1â‰¡â‰ ğ•©â‹„âŠ‘ğ•©}rxâŠ‘src
types 3âŒ¾(rxiâŠ¸âŠ‘)â†©

q â† {
  qâ‡âŸ¨âŸ©
  câ‡0â€¿0
  Push â‡ {c 1âŠ¸+âŒ¾((âŠ‘ğ•©)âŠ¸âŠ‘)â†© â‹„ qâˆ¾â†©<ğ•©}
  Pop â‡ {ğ•Š: râ†âŠ‘q â‹„ q 1âŠ¸â†“â†© â‹„ r}
  Len â‡ {ğ•Š:â‰ q}
}

Pulse â† {ğ•Špâ€¿fâ€¿t:
  m â† tâŠ‘types
  fi â† âŠ‘fâŠËœtâŠ‘src
  state mâ—¶âŸ¨
    1+âŠ¢
    pâŠ¸=
    pâŒ¾(fiâŠ¸âŠ‘)
    (bcâŠ‘state)âŒ¾(fiâŠ¸âŠ‘)âŸp
    âŠ¢
  âŸ©âŒ¾(tâŠ¸âŠ‘)â†©
  s â† tâŠ‘state
  q.PushÂ¨ mâ—¶âŸ¨
    pâŠ¸âˆ¾Â¨
    pâ—¶âŸ¨sâŠ¸âˆ¾Â¨,âŸ¨âŸ©âŸ©
    (Â¬Â·âˆ§Â´sË™)âŠ¸âˆ¾Â¨
    (Â¬Â·âˆ§Â´Ã—âˆ˜s)âŠ¸âˆ¾Â¨
    âŠ¢
  âŸ©tâ‹ˆÂ¨tâŠ‘dst
}

state â† types âŠ£â—¶âŸ¨0,0,0Â¨,0Â¨,0âŸ©Â¨src

Button â† {ğ•Š: Pulseâˆ˜q.Popâ€¢_while_(Ã—q.Len) q.Push 0â€¿bcâ€¿bc}

ButtonâŸ1000 @
â€¢Show Ã—Â´q.c

Buttonâ€¢_while_{ğ•Š:âˆ¨Â´0=rxiâŠ‘state} @
â€¢Show â€¢math.LCMÂ´rxiâŠ‘state
